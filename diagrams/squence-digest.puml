@startuml
actor "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫\n(Celery Beat)" as scheduler
participant "Digest Engine" as engine
participant "RSS/API Sources" as sources
participant "Filter & Relevance" as filter
participant "User Preferences DB\n(PostgreSQL)" as db
participant "LLM Orchestrator" as orchestrator
participant "LLM Provider" as llm
participant "Response Parser" as parser
participant "Cache (Redis)" as cache
participant "Telegram Bot" as bot
participant –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

title –î–∞–π–¥–∂–µ—Å—Ç: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø–æ–¥–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–µ–π –ø–æ —Ç–µ–º–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

scheduler -> engine: –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é\n(–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 9:00)
engine -> sources: –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏
sources --> engine: –°–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π\n(–∑–∞–≥–æ–ª–æ–≤–æ–∫, URL, –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è)

engine -> db: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
db --> engine: –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π + —Ç–µ–º—ã\n(e.g., NLP, DevOps)

loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    engine -> filter: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–µ–π –ø–æ —Ç–µ–º–∞–º
    filter --> engine: –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ (top 5)
    
    loop –î–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π —Å—Ç–∞—Ç—å–∏
        engine -> cache: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞?
        cache --> engine: –ù–µ—Ç (–∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–∞)
        
        engine -> orchestrator: –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞—Ç—å—é\n(–∫—Ä–∞—Ç–∫–∏–π —Ä–µ–∂–∏–º)
        orchestrator -> llm: –ó–∞–ø—Ä–æ—Å –∫ LLM\n(prompt: tags + summary)
        llm --> parser: Raw response
        parser --> orchestrator: –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
        orchestrator --> cache: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n(ttl=24h)
        orchestrator --> engine: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Ç–∫–∏–π summary + tags
    end
    
    engine -> engine: –§–æ—Ä–º–∏—Ä—É–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç\n(—Å–ø–∏—Å–æ–∫ 3‚Äì5 —Å—Ç–∞—Ç–µ–π)
    engine -> bot: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç user_id
    bot -> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç:\n\n1. [–ù–∞–∑–≤–∞–Ω–∏–µ]\n   üîñ RAG, NLP\n   üìù –ö—Ä–∞—Ç–∫–æ –æ –º–µ—Ç–æ–¥–∞—Ö...\n   üîó [—Å—Å—ã–ª–∫–∞]\n\n..."
end

note right of engine
  Digest Engine –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é\n(Celery Beat).
  –°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ –∏–∑ RSS, arXiv API,\nHabr, Medium –∏ –¥—Ä.
end note

note right of filter
  –§–∏–ª—å—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞\n–∏–∑ —Ç–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ\n—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
end note

note right of orchestrator
  –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–µ–∂–∏–º–µ "–∫—Ä–∞—Ç–∫–æ":\n—Ç–æ–ª—å–∫–æ —Ç–µ–≥–∏ + –∫—Ä–∞—Ç–∫–∏–π –ø–µ—Ä–µ—Å–∫–∞–∑,\n—á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –∑–∞–¥–µ—Ä–∂–∫—É.
end note

note right of cache
  –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç\n–ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–¥–Ω–∏—Ö\n–∏ —Ç–µ—Ö –∂–µ —Å—Ç–∞—Ç–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö\n–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
end note

note right of bot
  –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç –≤ —É–¥–æ–±–Ω–æ–º\n—á–∏—Ç–∞–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
  –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏:\n[–ü–æ–¥—Ä–æ–±–Ω–µ–µ] ‚Üí –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
end note

@enduml